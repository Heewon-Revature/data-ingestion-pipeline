# Data Ingestion Configuration
# Data source: Open Library API (https://openlibrary.org/developers/api)

defaults:
  db_url: postgresql+psycopg://postgres:password@localhost:5432/postgres
  batch_size: 5000

sources:
  - name: openlibrary_python_books
    path: https://openlibrary.org/search.json?q=python+programming&limit=100
    target_table: stg_books
    pk: [key]
    schema:
      key: str
      title: str
      author_name: str
      first_publish_year: int
      edition_count: int
      language: str
      has_fulltext: bool
    rules:
      - "len(title) > 0"
      - "len(author_name) > 0"
      - "first_publish_year NOT NULL"
      - "len(language) > 0"
      - "edition_count NOT NULL"
      - "has_fulltext NOT NULL"

  - name: openlibrary_scifi_books
    path: https://openlibrary.org/search.json?subject=science+fiction&limit=100
    target_table: stg_books
    pk: [key]
    schema:
      key: str
      title: str
      author_name: str
      first_publish_year: int
      edition_count: int
      language: str
      has_fulltext: bool
    rules:
      - "len(title) > 0"
      - "len(author_name) > 0"
      - "first_publish_year NOT NULL"
      - "len(language) > 0"
      - "edition_count NOT NULL"
      - "has_fulltext NOT NULL"

  - name: openlibrary_classics
    path: https://openlibrary.org/search.json?subject=classic+literature&limit=100
    target_table: stg_books
    pk: [key]
    schema:
      key: str
      title: str
      author_name: str
      first_publish_year: int
      edition_count: int
      language: str
      has_fulltext: bool
    rules:
      - "len(title) > 0"
      - "len(author_name) > 0"
      - "first_publish_year NOT NULL"
      - "len(language) > 0"
      - "edition_count NOT NULL"
      - "has_fulltext NOT NULL"

  - name: openlibrary_fantasy
    path: https://openlibrary.org/search.json?subject=fantasy&limit=100
    target_table: stg_books
    pk: [key]
    schema:
      key: str
      title: str
      author_name: str
      first_publish_year: int
      edition_count: int
      language: str
      has_fulltext: bool
    rules:
      - "len(title) > 0"
      - "len(author_name) > 0"
      - "first_publish_year NOT NULL"
      - "len(language) > 0"
      - "edition_count NOT NULL"
      - "has_fulltext NOT NULL"

  - name: openlibrary_mystery
    path: https://openlibrary.org/search.json?subject=mystery&limit=100
    target_table: stg_books
    pk: [key]
    schema:
      key: str
      title: str
      author_name: str
      first_publish_year: int
      edition_count: int
      language: str
      has_fulltext: bool
    rules:
      - "len(title) > 0"
      - "len(author_name) > 0"
      - "first_publish_year NOT NULL"
      - "len(language) > 0"
      - "edition_count NOT NULL"
      - "has_fulltext NOT NULL"

  - name: openlibrary_history
    path: https://openlibrary.org/search.json?subject=history&limit=100
    target_table: stg_books
    pk: [key]
    schema:
      key: str
      title: str
      author_name: str
      first_publish_year: int
      edition_count: int
      language: str
      has_fulltext: bool
    rules:
      - "len(title) > 0"
      - "len(author_name) > 0"
      - "first_publish_year NOT NULL"
      - "len(language) > 0"
      - "edition_count NOT NULL"
      - "has_fulltext NOT NULL"

  - name: openlibrary_biography
    path: https://openlibrary.org/search.json?subject=biography&limit=100
    target_table: stg_books
    pk: [key]
    schema:
      key: str
      title: str
      author_name: str
      first_publish_year: int
      edition_count: int
      language: str
      has_fulltext: bool
    rules:
      - "len(title) > 0"
      - "len(author_name) > 0"
      - "first_publish_year NOT NULL"
      - "len(language) > 0"
      - "edition_count NOT NULL"
      - "has_fulltext NOT NULL"

  - name: openlibrary_horror
    path: https://openlibrary.org/search.json?subject=horror&limit=100
    target_table: stg_books
    pk: [key]
    schema:
      key: str
      title: str
      author_name: str
      first_publish_year: int
      edition_count: int
      language: str
      has_fulltext: bool
    rules:
      - "len(title) > 0"
      - "len(author_name) > 0"
      - "first_publish_year NOT NULL"
      - "len(language) > 0"
      - "edition_count NOT NULL"
      - "has_fulltext NOT NULL"

  - name: openlibrary_romance
    path: https://openlibrary.org/search.json?subject=romance&limit=100
    target_table: stg_books
    pk: [key]
    schema:
      key: str
      title: str
      author_name: str
      first_publish_year: int
      edition_count: int
      language: str
      has_fulltext: bool
    rules:
      - "len(title) > 0"
      - "len(author_name) > 0"
      - "first_publish_year NOT NULL"
      - "len(language) > 0"
      - "edition_count NOT NULL"
      - "has_fulltext NOT NULL"

  - name: openlibrary_philosophy
    path: https://openlibrary.org/search.json?subject=philosophy&limit=100
    target_table: stg_books
    pk: [key]
    schema:
      key: str
      title: str
      author_name: str
      first_publish_year: int
      edition_count: int
      language: str
      has_fulltext: bool
    rules:
      - "len(title) > 0"
      - "len(author_name) > 0"
      - "first_publish_year NOT NULL"
      - "len(language) > 0"
      - "edition_count NOT NULL"
      - "has_fulltext NOT NULL"
